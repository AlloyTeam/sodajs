!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.soda=t():e.soda=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(1),u=r(2),s="undefined"!=typeof document?document:{},c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"soda-";n(this,e),this._prefix=t}return o(e,[{key:"setDocument",value:function(e){s=e}},{key:"run",value:function(e,t){var r=this,n=s.createElement("div");s.documentMode<9&&(n.style.display="none",s.body.appendChild(n)),n.innerHTML=e,(0,u.nodes2Arr)(n.childNodes).map(function(e){r.compileNode(e,t)});var i=n.innerHTML;return s.documentMode<9&&s.body.removeChild(n),i}},{key:"prefix",value:function(e){this._prefix=e}},{key:"_getPrefixReg",value:function(){return new RegExp("^"+this._prefix)}},{key:"_getPrefixedDirectiveMap",value:function(){var t=this,r={};return e.sodaDirectives.map(function(e){var n=t._prefix+e.name;r[n]=e}),r}},{key:"_removeSodaMark",value:function(e,t){e.removeAttribute(t)}},{key:"compileNode",value:function(t,r){var n=this,o=this._getPrefixReg(),c=e.sodaDirectives,l=this._getPrefixedDirectiveMap();!function e(t,r){t.nodeType===(t.TEXT_NODE||3)&&(t.nodeValue=t.nodeValue.replace(a.VALUE_OUT_REG,function(e,t){var o=n.parseSodaExpression(t,r);return"object"===(void 0===o?"undefined":i(o))&&(o=JSON.stringify(o,null,2)),o})),t.attributes&&t.attributes.length&&(c.map(function(e){var i=e.name,o=e.opt,a=n._prefix+i;if((0,u.exist)(t.getAttribute(a))){var c=t.getAttribute(a);o.link.bind(n)({expression:c,scope:r,el:t,parseSodaExpression:n.parseSodaExpression.bind(n),getValue:n.getValue.bind(n),compileNode:n.compileNode.bind(n),document:s}),n._removeSodaMark(t,a)}}),(0,u.nodes2Arr)(t.attributes).filter(function(e){return!l[e.name]}).map(function(e){if(o.test(e.name)){var i=e.name.replace(o,"");if(i&&(0,u.exist)(e.value)){var s=e.value.replace(a.VALUE_OUT_REG,function(e,t){return n.parseSodaExpression(t,r)});t.setAttribute(i,s),n._removeSodaMark(t,e.name)}}else(0,u.exist)(e.value)&&(e.value=e.value.replace(a.VALUE_OUT_REG,function(e,t){return n.parseSodaExpression(t,r)}))})),(0,u.nodes2Arr)(t.childNodes).map(function(t){e(t,r)})}(t,r)}},{key:"getEvalFunc",value:function(t){return new Function("getValue","sodaFilterMap","return function sodaExp(scope){ return "+t+"}")(this.getValue,e.sodaFilterMap)}},{key:"getValue",value:function(e,t){a.CONST_REGG.lastIndex=0;t.replace(a.CONST_REGG,function(t){return void 0===e[t]?t:e[t]});if("true"===t)return!0;if("false"===t)return!1;return function t(r,n){var i=n.indexOf(".");if(i>-1){var o=n.substr(0,i);if(n=n.substr(i+1),void 0!==e[o]&&a.CONST_REG.test(o)&&(o=e[o]),void 0!==r[o])return t(r[o],n);return""}n=n.trim(),void 0!==e[n]&&a.CONST_REG.test(n)&&(n=e[n]);var u;if(void 0!==r[n])u=r[n];else{u=""}return u}(e,t)}},{key:"parseSodaExpression",value:function(e,t){var r=this;e=e.replace(a.STRING_REG,function(e,r,n){var i=(0,u.getRandom)();return t[i]=r||n,i}),e=e.replace(a.OR_REG,a.OR_REPLACE).split("|");for(var n=0;n<e.length;n++)e[n]=(e[n].replace(new RegExp(a.OR_REPLACE,"g"),"||")||"").trim();for(var i=e[0]||"",o=e.slice(1);a.ATTR_REG_NG.test(i);)a.ATTR_REG.lastIndex=0,i=i.replace(a.ATTR_REG,function(e,n){var i=(0,u.getAttrVarKey)(),o=r.parseSodaExpression(n,t);return t[i]=o,"."+i});return i=i.replace(a.OBJECT_REG,function(e){return"getValue(scope,'"+e.trim()+"')"}),i=this.parseFilter(o,i),this.getEvalFunc(i)(t)}},{key:"parseFilter",value:function(t,r){var n=e.sodaFilterMap;return function e(){var i=t.shift();if(i){for(var i=i.split(":"),o=i.slice(1)||[],u=(i[0]||"").trim(),s=0;s<o.length;s++)a.OBJECT_REG_NG.test(o[s])&&(o[s]="getValue(scope,'"+o[s]+"')");n[u]&&(o.unshift(r),o=o.join(","),r="sodaFilterMap['"+u+"']("+o+")"),e()}}(),r}}],[{key:"filter",value:function(e,t){this.sodaFilterMap[e]=t}},{key:"getFilter",value:function(e){return this.sodaFilterMap[e]}},{key:"directive",value:function(e,t){var r=t.priority,n=void 0===r?0:r,i=void 0;for(i=0;i<this.sodaDirectives.length;i++){var o=this.sodaDirectives[i],a=o.opt.priority,u=void 0===a?0:a;if(n<u);else if(n>=u)break}this.sodaDirectives.splice(i,0,{name:e,opt:t})}},{key:"discribe",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{compile:!0};this.template[e]={funcOrStr:t,option:r}}},{key:"getTmpl",value:function(e,t){var r=this.template[e],n=r.funcOrStr,i=r.option,o=void 0===i?{}:i,a=void 0;return a="function"==typeof n?n.apply(null,t):n,{template:a,option:o}}}]),e}();c.sodaDirectives=[],c.sodaFilterMap={},c.template={},t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IDENTOR_REG=/[a-zA-Z_\$]+[\w\$]*/g,t.STRING_REG=/"([^"]*)"|'([^']*)'/g,t.NUMBER_REG=/\d+|\d*\.\d+/g,t.OBJECT_REG=/[a-zA-Z_\$]+[\w\$]*(?:\s*\.\s*(?:[a-zA-Z_\$]+[\w\$]*|\d+))*/g,t.OBJECT_REG_NG=/[a-zA-Z_\$]+[\w\$]*(?:\s*\.\s*(?:[a-zA-Z_\$]+[\w\$]*|\d+))*/,t.ATTR_REG=/\[([^\[\]]*)\]/g,t.ATTR_REG_NG=/\[([^\[\]]*)\]/,t.ATTR_REG_DOT=/\.([a-zA-Z_\$]+[\w\$]*)/g,t.NOT_ATTR_REG=/[^\.|]([a-zA-Z_\$]+[\w\$]*)/g,t.OR_REG=/\|\|/g,t.OR_REPLACE="OR_OPERATOR",t.CONST_PRIFIX="_$C$_",t.CONST_REG=/^_\$C\$_/,t.CONST_REGG=/_\$C\$_[^\.]+/g,t.VALUE_OUT_REG=/\{\{([^\}]*)\}\}/g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assign=t.nodes2Arr=t.exist=t.getRandom=t.getAttrVarKey=void 0;var n=r(1),i=(t.getAttrVarKey=function(){return n.CONST_PRIFIX+~~(1e6*Math.random())},t.getRandom=function(){return"$$"+~~(1e6*Math.random())},t.exist=function(e){return null!==e&&void 0!==e&&""!==e&&void 0!==e},t.nodes2Arr=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t},Object.getOwnPropertySymbols),o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,u=function(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)};t.assign=Object.assign||function(e,t){for(var r,n,s=u(e),c=1;c<arguments.length;c++){r=Object(arguments[c]);for(var l in r)o.call(r,l)&&(s[l]=r[l]);if(i){n=i(r);for(var f=0;f<n.length;f++)a.call(r,n[f])&&(s[n[f]]=r[n[f]])}}return s}},function(e,t,r){"use strict";var n=r(0),i=function(e){return e&&e.__esModule?e:{default:e}}(n),o=r(2);r(4),r(5),r(6),r(7),r(8),r(9),r(10);var a=new i.default,u=function(e,t){return a.run(e,t)},s={prefix:function(e){a.prefix(e)},filter:function(e,t){i.default.filter(e,t)},directive:function(e,t){i.default.directive(e,t)},setDocument:function(e){a.setDocument(e)},discribe:function(e,t,r){i.default.discribe(e,t,r)},Soda:i.default},c=(0,o.assign)(u,s);e.exports=c},function(e,t,r){"use strict";var n=r(0);(function(e){return e&&e.__esModule?e:{default:e}})(n).default.directive("repeat",{priority:10,link:function(e){var t,r,n,i=this,o=e.scope,a=e.el,u=e.expression,s=e.getValue,c=(e.parseSodaExpression,e.compileNode),l=/\s+by\s+([^\s]+)$/,f=u.replace(l,function(e,t){return t&&(n=(t||"").trim()),""}),d=/([^\s]+)\s+in\s+([^\s]+)|\(([^,]+)\s*,\s*([^)]+)\)\s+in\s+([^\s]+)/,p=d.exec(f);if(p){if(p[1]&&p[2]){if(t=(p[1]||"").trim(),r=(p[2]||"").trim(),!t||!r)return}else p[3]&&p[4]&&p[5]&&(n=(p[3]||"").trim(),t=(p[4]||"").trim(),r=(p[5]||"").trim());n=n||"$index";var v=s(o,r)||[],_=function(e){var r=a.cloneNode(!0),u=Object.create(o);u[n]=e,u[t]=v[e],r.removeAttribute(i._prefix+"repeat"),a.parentNode.insertBefore(r,a),c(r,u)};if("length"in v)for(var m=0;m<v.length;m++)_(m);else for(var m in v)v.hasOwnProperty(m)&&_(m);a.parentNode.removeChild(a)}}})},function(e,t,r){"use strict";var n=r(0);(function(e){return e&&e.__esModule?e:{default:e}})(n).default.directive("if",{priority:9,link:function(e){var t=e.expression,r=e.parseSodaExpression,n=e.scope,i=e.el;r(t,n)||i.parentNode&&i.parentNode.removeChild(i)}})},function(e,t,r){"use strict";var n=r(0),i=function(e){return e&&e.__esModule?e:{default:e}}(n),o=function(e){return new RegExp("(^|\\s+)"+e+"(\\s+|$)","g")},a=function(e,t){if(!e.className)return void(e.className=t);e.className.match(o(t))||(e.className+=" "+t)};i.default.directive("class",{link:function(e){var t=e.scope,r=e.el,n=e.expression,i=e.parseSodaExpression,o=i(n,t);o&&a(r,o)}})},function(e,t,r){"use strict";var n=r(0);(function(e){return e&&e.__esModule?e:{default:e}})(n).default.directive("html",{link:function(e){var t=e.expression,r=e.scope,n=e.el,i=e.parseSodaExpression,o=i(t,r);o&&(n.innerHTML=o)}})},function(e,t,r){"use strict";var n=r(0);(function(e){return e&&e.__esModule?e:{default:e}})(n).default.directive("replace",{link:function(e){var t=e.scope,r=e.el,n=e.expression,i=e.parseSodaExpression,o=e.document,a=i(n,t);if(a){var u=o.createElement("div");if(u.innerHTML=a,r.parentNode)for(;u.childNodes[0];)r.parentNode.insertBefore(u.childNodes[0],r)}r.parentNode&&r.parentNode.removeChild(r)}})},function(e,t,r){"use strict";var n=r(0);(function(e){return e&&e.__esModule?e:{default:e}})(n).default.directive("style",{link:function(e){var t=e.scope,r=e.el,n=e.expression,i=e.parseSodaExpression,o=i(n,t);if(o){var a=[];for(var u in o)if(o.hasOwnProperty(u)){var s=function(e,t){return/opacity|z-index/.test(e)?parseFloat(t):isNaN(t)?t:t+"px"}(u,o[u]);a.push([u,s].join(":"))}for(var c=r.style,u=0;u<c.length;u++){var l=c[u];o[l]||a.push([l,c[l]].join(":"))}var f=a.join(";");r.setAttribute("style",f)}}})},function(e,t,r){"use strict";var n=r(0),i=function(e){return e&&e.__esModule?e:{default:e}}(n);i.default.directive("include",{priority:8,link:function(e){var t=e.scope,r=e.el,n=e.parseSodaExpression,o=e.expression,a=/\{\{([^\}]*)\}\}/g,u=o.replace(a,function(e,r){return n(r,t)});u=u.split(":");var s=u[0],c=u.slice(1),l=i.default.getTmpl(s,c),f=l.template,d=l.option,p=void 0===d?{}:d;f&&(p.compile?r.outerHTML=this.run(f,t):r.outerHTML=f)}})}])});